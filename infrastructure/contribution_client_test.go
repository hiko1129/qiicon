package infrastructure_test

import (
	"testing"

	"github.com/hiko1129/qiicon/infrastructure"
	"github.com/hiko1129/qiicon/qiicon"
	"github.com/stretchr/testify/assert"
	httpmock "gopkg.in/jarcoal/httpmock.v1"
)

func TestNew(t *testing.T) {
	_, err := qiicon.New("hiko1129")
	assert.NoError(t, err)
}

func TestFetchTotalContributions(t *testing.T) {
	// real
	c, err := infrastructure.NewContirubutionClient()
	assert.NoError(t, err)

	contributions, err := c.FetchContributions("hiko1129")
	assert.NotEmpty(t, contributions)
	assert.NoError(t, err)

	// mock
	httpmock.Activate()
	defer httpmock.DeactivateAndReset()

	dom := `<div class="userActivityChart js-userActivityChart" data-chart="contribution" data-props="{&quot;axis&quot;:{&quot;x&quot;:{&quot;type&quot;:&quot;timeseries&quot;},&quot;y&quot;:{&quot;min&quot;:0,&quot;max&quot;:1,&quot;tick&quot;:{&quot;values&quot;:[0,0,1]}}},&quot;data&quot;:{&quot;columns&quot;:[[&quot;date&quot;,&quot;2018-10-21&quot;,&quot;2018-10-22&quot;,&quot;2018-10-23&quot;,&quot;2018-10-24&quot;,&quot;2018-10-25&quot;,&quot;2018-10-26&quot;,&quot;2018-10-27&quot;,&quot;2018-10-28&quot;,&quot;2018-10-29&quot;,&quot;2018-10-30&quot;,&quot;2018-10-31&quot;,&quot;2018-11-01&quot;,&quot;2018-11-02&quot;,&quot;2018-11-03&quot;,&quot;2018-11-04&quot;,&quot;2018-11-05&quot;,&quot;2018-11-06&quot;,&quot;2018-11-07&quot;,&quot;2018-11-08&quot;,&quot;2018-11-09&quot;,&quot;2018-11-10&quot;,&quot;2018-11-11&quot;,&quot;2018-11-12&quot;,&quot;2018-11-13&quot;,&quot;2018-11-14&quot;,&quot;2018-11-15&quot;,&quot;2018-11-16&quot;,&quot;2018-11-17&quot;,&quot;2018-11-18&quot;,&quot;2018-11-19&quot;],[&quot;contribution&quot;,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]],&quot;type&quot;:&quot;area&quot;,&quot;hide&quot;:&quot;date&quot;,&quot;x&quot;:&quot;date&quot;,&quot;axes&quot;:{&quot;contribution&quot;:&quot;y&quot;}},&quot;grid&quot;:{&quot;x&quot;:{&quot;lines&quot;:[]},&quot;y&quot;:{&quot;show&quot;:true}},&quot;legend&quot;:{&quot;hide&quot;:true},&quot;padding&quot;:{&quot;right&quot;:10}}"><div class="userActivityChart_svg js-userActivityChartSVG c3" style="max-height: 270px; position: relative;"><svg width="850" height="270" style="overflow: hidden;"><defs><clipPath id="c3-1542555218841-clip"><rect width="809" height="216"></rect></clipPath><clipPath id="c3-1542555218841-clip-xaxis"><rect x="-31" y="-20" width="871" height="70"></rect></clipPath><clipPath id="c3-1542555218841-clip-yaxis"><rect x="-29" y="-4" width="50" height="240"></rect></clipPath><clipPath id="c3-1542555218841-clip-grid"><rect width="809" height="216"></rect></clipPath><clipPath id="c3-1542555218841-clip-subchart"><rect width="809"></rect></clipPath></defs><g transform="translate(30.5,4.5)"><text class="c3-text c3-empty" text-anchor="middle" dominant-baseline="middle" x="404.5" y="108" style="opacity: 0;"></text><rect class="c3-zoom-rect" width="809" height="216" style="opacity: 0;"></rect><g clip-path="url(https://qiita.com/hiko1129/contributions#c3-1542555218841-clip)" class="c3-regions" style="visibility: visible;"></g><g clip-path="url(https://qiita.com/hiko1129/contributions#c3-1542555218841-clip-grid)" class="c3-grid" style="visibility: visible;"><g class="c3-ygrids"><line class="c3-ygrid" x1="0" x2="809" y1="199" y2="199"></line><line class="c3-ygrid" x1="0" x2="809" y1="199" y2="199"></line><line class="c3-ygrid" x1="0" x2="809" y1="19" y2="19"></line></g><g class="c3-xgrid-focus"><line class="c3-xgrid-focus" x1="364" x2="364" y1="0" y2="216" style="visibility: hidden;"></line></g></g><g clip-path="url(https://qiita.com/hiko1129/contributions#c3-1542555218841-clip)" class="c3-chart"><g class="c3-event-rects c3-event-rects-single" style="fill-opacity: 0;"><rect class=" c3-event-rect c3-event-rect-0" x="4" y="0" width="18" height="216"></rect><rect class=" c3-event-rect c3-event-rect-1" x="22" y="0" width="27.5" height="216"></rect><rect class=" c3-event-rect c3-event-rect-2" x="49.5" y="0" width="27" height="216"></rect><rect class=" c3-event-rect c3-event-rect-3" x="76.5" y="0" width="27.5" height="216"></rect><rect class=" c3-event-rect c3-event-rect-4" x="104" y="0" width="27.5" height="216"></rect><rect class=" c3-event-rect c3-event-rect-5" x="131.5" y="0" width="27.5" height="216"></rect><rect class=" c3-event-rect c3-event-rect-6" x="159" y="0" width="27.5" height="216"></rect><rect class=" c3-event-rect c3-event-rect-7" x="186.5" y="0" width="27" height="216"></rect><rect class=" c3-event-rect c3-event-rect-8" x="213.5" y="0" width="27.5" height="216"></rect><rect class=" c3-event-rect c3-event-rect-9" x="241" y="0" width="27.5" height="216"></rect><rect class=" c3-event-rect c3-event-rect-10" x="268.5" y="0" width="27" height="216"></rect><rect class=" c3-event-rect c3-event-rect-11" x="295.5" y="0" width="27.5" height="216"></rect><rect class=" c3-event-rect c3-event-rect-12" x="323" y="0" width="27.5" height="216"></rect><rect class=" c3-event-rect c3-event-rect-13" x="350.5" y="0" width="27" height="216"></rect><rect class=" c3-event-rect c3-event-rect-14" x="377.5" y="0" width="27.5" height="216"></rect><rect class=" c3-event-rect c3-event-rect-15" x="405" y="0" width="27.5" height="216"></rect><rect class=" c3-event-rect c3-event-rect-16" x="432.5" y="0" width="27" height="216"></rect><rect class=" c3-event-rect c3-event-rect-17" x="459.5" y="0" width="27.5" height="216"></rect><rect class=" c3-event-rect c3-event-rect-18" x="487" y="0" width="27.5" height="216"></rect><rect class=" c3-event-rect c3-event-rect-19" x="514.5" y="0" width="27" height="216"></rect><rect class=" c3-event-rect c3-event-rect-20" x="541.5" y="0" width="27.5" height="216"></rect><rect class=" c3-event-rect c3-event-rect-21" x="569" y="0" width="27.5" height="216"></rect><rect class=" c3-event-rect c3-event-rect-22" x="596.5" y="0" width="27" height="216"></rect><rect class=" c3-event-rect c3-event-rect-23" x="623.5" y="0" width="27.5" height="216"></rect><rect class=" c3-event-rect c3-event-rect-24" x="651" y="0" width="27.5" height="216"></rect><rect class=" c3-event-rect c3-event-rect-25" x="678.5" y="0" width="27.5" height="216"></rect><rect class=" c3-event-rect c3-event-rect-26" x="706" y="0" width="27.5" height="216"></rect><rect class=" c3-event-rect c3-event-rect-27" x="733.5" y="0" width="27" height="216"></rect><rect class=" c3-event-rect c3-event-rect-28" x="760.5" y="0" width="27.5" height="216"></rect><rect class=" c3-event-rect c3-event-rect-29" x="788" y="0" width="17.5" height="216"></rect></g><g class="c3-chart-bars"><g class="c3-chart-bar c3-target c3-target-contribution" style="opacity: 1; pointer-events: none;"><g class=" c3-shapes c3-shapes-contribution c3-bars c3-bars-contribution" style="cursor: pointer;"></g></g></g><g class="c3-chart-lines"><g class="c3-chart-line c3-target c3-target-contribution" style="opacity: 1; pointer-events: none;"><g class=" c3-shapes c3-shapes-contribution c3-lines c3-lines-contribution"><path class=" c3-shape c3-shape c3-line c3-line-contribution" d="M8,198.08333333333334L36,198.08333333333334L63,198.08333333333334L90,198.08333333333334L118,198.08333333333334L145,198.08333333333334L173,198.08333333333334L200,198.08333333333334L227,198.08333333333334L255,198.08333333333334L282,198.08333333333334L309,198.08333333333334L337,198.08333333333334L364,198.08333333333334L391,198.08333333333334L419,198.08333333333334L446,198.08333333333334L473,198.08333333333334L501,198.08333333333334L528,198.08333333333334L555,198.08333333333334L583,198.08333333333334L610,198.08333333333334L637,198.08333333333334L665,198.08333333333334L692,198.08333333333334L720,198.08333333333334L747,198.08333333333334L774,198.08333333333334L802,198.08333333333334" style="opacity: 1;"></path></g><g class=" c3-shapes c3-shapes-contribution c3-areas c3-areas-contribution"><path class=" c3-shape c3-shape c3-area c3-area-contribution" d="M8,198.08333333333334L36,198.08333333333334L63,198.08333333333334L90,198.08333333333334L118,198.08333333333334L145,198.08333333333334L173,198.08333333333334L200,198.08333333333334L227,198.08333333333334L255,198.08333333333334L282,198.08333333333334L309,198.08333333333334L337,198.08333333333334L364,198.08333333333334L391,198.08333333333334L419,198.08333333333334L446,198.08333333333334L473,198.08333333333334L501,198.08333333333334L528,198.08333333333334L555,198.08333333333334L583,198.08333333333334L610,198.08333333333334L637,198.08333333333334L665,198.08333333333334L692,198.08333333333334L720,198.08333333333334L747,198.08333333333334L774,198.08333333333334L802,198.08333333333334L802,198.08333333333334L774,198.08333333333334L747,198.08333333333334L720,198.08333333333334L692,198.08333333333334L665,198.08333333333334L637,198.08333333333334L610,198.08333333333334L583,198.08333333333334L555,198.08333333333334L528,198.08333333333334L501,198.08333333333334L473,198.08333333333334L446,198.08333333333334L419,198.08333333333334L391,198.08333333333334L364,198.08333333333334L337,198.08333333333334L309,198.08333333333334L282,198.08333333333334L255,198.08333333333334L227,198.08333333333334L200,198.08333333333334L173,198.08333333333334L145,198.08333333333334L118,198.08333333333334L90,198.08333333333334L63,198.08333333333334L36,198.08333333333334L8,198.08333333333334Z" style="opacity: 0.2;"></path></g><g class=" c3-selected-circles c3-selected-circles-contribution"></g><g class=" c3-shapes c3-shapes-contribution c3-circles c3-circles-contribution" style="cursor: pointer;"><circle class="c3-shape c3-shape-0 c3-circle c3-circle-0" r="2.5" style="opacity: 1;" cx="8" cy="198.08333333333334"></circle><circle class="c3-shape c3-shape-1 c3-circle c3-circle-1" r="2.5" style="opacity: 1;" cx="36" cy="198.08333333333334"></circle><circle class="c3-shape c3-shape-2 c3-circle c3-circle-2" r="2.5" style="opacity: 1;" cx="63" cy="198.08333333333334"></circle><circle class="c3-shape c3-shape-3 c3-circle c3-circle-3" r="2.5" style="opacity: 1;" cx="90" cy="198.08333333333334"></circle><circle class="c3-shape c3-shape-4 c3-circle c3-circle-4" r="2.5" style="opacity: 1;" cx="118" cy="198.08333333333334"></circle><circle class="c3-shape c3-shape-5 c3-circle c3-circle-5" r="2.5" style="opacity: 1;" cx="145" cy="198.08333333333334"></circle><circle class="c3-shape c3-shape-6 c3-circle c3-circle-6" r="2.5" style="opacity: 1;" cx="173" cy="198.08333333333334"></circle><circle class=" c3-shape c3-shape-7 c3-circle c3-circle-7" r="2.5" style="opacity: 1;" cx="200" cy="198.08333333333334"></circle><circle class="c3-shape c3-shape-8 c3-circle c3-circle-8" r="2.5" style="opacity: 1;" cx="227" cy="198.08333333333334"></circle><circle class="c3-shape c3-shape-9 c3-circle c3-circle-9" r="2.5" style="opacity: 1;" cx="255" cy="198.08333333333334"></circle><circle class=" c3-shape c3-shape-10 c3-circle c3-circle-10" r="2.5" style="opacity: 1;" cx="282" cy="198.08333333333334"></circle><circle class="c3-shape c3-shape-11 c3-circle c3-circle-11" r="2.5" style="opacity: 1;" cx="309" cy="198.08333333333334"></circle><circle class="c3-shape c3-shape-12 c3-circle c3-circle-12" r="2.5" style="opacity: 1;" cx="337" cy="198.08333333333334"></circle><circle class="c3-shape c3-shape-13 c3-circle c3-circle-13" r="2.5" style="opacity: 1;" cx="364" cy="198.08333333333334"></circle><circle class="c3-shape c3-shape-14 c3-circle c3-circle-14" r="2.5" style="opacity: 1;" cx="391" cy="198.08333333333334"></circle><circle class="c3-shape c3-shape-15 c3-circle c3-circle-15" r="2.5" style="opacity: 1;" cx="419" cy="198.08333333333334"></circle><circle class="c3-shape c3-shape-16 c3-circle c3-circle-16" r="2.5" style="opacity: 1;" cx="446" cy="198.08333333333334"></circle><circle class="c3-shape c3-shape-17 c3-circle c3-circle-17" r="2.5" style="opacity: 1;" cx="473" cy="198.08333333333334"></circle><circle class="c3-shape c3-shape-18 c3-circle c3-circle-18" r="2.5" style="opacity: 1;" cx="501" cy="198.08333333333334"></circle><circle class="c3-shape c3-shape-19 c3-circle c3-circle-19" r="2.5" style="opacity: 1;" cx="528" cy="198.08333333333334"></circle><circle class="c3-shape c3-shape-20 c3-circle c3-circle-20" r="2.5" style="opacity: 1;" cx="555" cy="198.08333333333334"></circle><circle class="c3-shape c3-shape-21 c3-circle c3-circle-21" r="2.5" style="opacity: 1;" cx="583" cy="198.08333333333334"></circle><circle class="c3-shape c3-shape-22 c3-circle c3-circle-22" r="2.5" style="opacity: 1;" cx="610" cy="198.08333333333334"></circle><circle class="c3-shape c3-shape-23 c3-circle c3-circle-23" r="2.5" style="opacity: 1;" cx="637" cy="198.08333333333334"></circle><circle class="c3-shape c3-shape-24 c3-circle c3-circle-24" r="2.5" style="opacity: 1;" cx="665" cy="198.08333333333334"></circle><circle class="c3-shape c3-shape-25 c3-circle c3-circle-25" r="2.5" style="opacity: 1;" cx="692" cy="198.08333333333334"></circle><circle class="c3-shape c3-shape-26 c3-circle c3-circle-26" r="2.5" style="opacity: 1;" cx="720" cy="198.08333333333334"></circle><circle class="c3-shape c3-shape-27 c3-circle c3-circle-27" r="2.5" style="opacity: 1;" cx="747" cy="198.08333333333334"></circle><circle class="c3-shape c3-shape-28 c3-circle c3-circle-28" r="2.5" style="opacity: 1;" cx="774" cy="198.08333333333334"></circle><circle class="c3-shape c3-shape-29 c3-circle c3-circle-29" r="2.5" style="opacity: 1;" cx="802" cy="198.08333333333334"></circle></g></g></g><g class="c3-chart-arcs" transform="translate(404.5,103)"><text class="c3-chart-arcs-title" style="text-anchor: middle; opacity: 0;"></text></g><g class="c3-chart-texts"><g class="c3-chart-text c3-target c3-target-contribution" style="opacity: 1; pointer-events: none;"><g class=" c3-texts c3-texts-contribution"></g></g></g></g><g clip-path="url(https://qiita.com/hiko1129/contributions#c3-1542555218841-clip-grid)" class="c3-grid c3-grid-lines"><g class="c3-xgrid-lines"></g><g class="c3-ygrid-lines"></g></g><g class="c3-axis c3-axis-x" clip-path="url(https://qiita.com/hiko1129/contributions#c3-1542555218841-clip-xaxis)" transform="translate(0,216)" style="visibility: visible; opacity: 1;"><text class="c3-axis-x-label" transform="" style="text-anchor: end;" x="809" dx="-0.5em" dy="-0.5em"></text><g class="tick" transform="translate(8, 0)" style="opacity: 1;"><line y2="6" x1="0" x2="0"></line><text y="9" x="0" transform="" style="text-anchor: middle; display: block;"><tspan x="0" dy=".71em" dx="0">10/21</tspan></text></g><g class="tick" transform="translate(36, 0)" style="opacity: 1;"><line y2="6" x1="0" x2="0"></line><text y="9" x="0" transform="" style="text-anchor: middle; display: none;"><tspan x="0" dy=".71em" dx="0">10/22</tspan></text></g><g class="tick" transform="translate(63, 0)" style="opacity: 1;"><line y2="6" x1="0" x2="0"></line><text y="9" x="0" transform="" style="text-anchor: middle; display: none;"><tspan x="0" dy=".71em" dx="0">10/23</tspan></text></g><g class="tick" transform="translate(90, 0)" style="opacity: 1;"><line y2="6" x1="0" x2="0"></line><text y="9" x="0" transform="" style="text-anchor: middle; display: none;"><tspan x="0" dy=".71em" dx="0">10/24</tspan></text></g><g class="tick" transform="translate(118, 0)" style="opacity: 1;"><line y2="6" x1="0" x2="0"></line><text y="9" x="0" transform="" style="text-anchor: middle; display: block;"><tspan x="0" dy=".71em" dx="0">10/25</tspan></text></g><g class="tick" transform="translate(145, 0)" style="opacity: 1;"><line y2="6" x1="0" x2="0"></line><text y="9" x="0" transform="" style="text-anchor: middle; display: none;"><tspan x="0" dy=".71em" dx="0">10/26</tspan></text></g><g class="tick" transform="translate(173, 0)" style="opacity: 1;"><line y2="6" x1="0" x2="0"></line><text y="9" x="0" transform="" style="text-anchor: middle; display: none;"><tspan x="0" dy=".71em" dx="0">10/27</tspan></text></g><g class="tick" transform="translate(200, 0)" style="opacity: 1;"><line y2="6" x1="0" x2="0"></line><text y="9" x="0" transform="" style="text-anchor: middle; display: none;"><tspan x="0" dy=".71em" dx="0">10/28</tspan></text></g><g class="tick" transform="translate(227, 0)" style="opacity: 1;"><line y2="6" x1="0" x2="0"></line><text y="9" x="0" transform="" style="text-anchor: middle; display: block;"><tspan x="0" dy=".71em" dx="0">10/29</tspan></text></g><g class="tick" transform="translate(255, 0)" style="opacity: 1;"><line y2="6" x1="0" x2="0"></line><text y="9" x="0" transform="" style="text-anchor: middle; display: none;"><tspan x="0" dy=".71em" dx="0">10/30</tspan></text></g><g class="tick" transform="translate(282, 0)" style="opacity: 1;"><line y2="6" x1="0" x2="0"></line><text y="9" x="0" transform="" style="text-anchor: middle; display: none;"><tspan x="0" dy=".71em" dx="0">10/31</tspan></text></g><g class="tick" transform="translate(309, 0)" style="opacity: 1;"><line y2="6" x1="0" x2="0"></line><text y="9" x="0" transform="" style="text-anchor: middle; display: none;"><tspan x="0" dy=".71em" dx="0">11/1</tspan></text></g><g class="tick" transform="translate(337, 0)" style="opacity: 1;"><line y2="6" x1="0" x2="0"></line><text y="9" x="0" transform="" style="text-anchor: middle; display: block;"><tspan x="0" dy=".71em" dx="0">11/2</tspan></text></g><g class="tick" transform="translate(364, 0)" style="opacity: 1;"><line y2="6" x1="0" x2="0"></line><text y="9" x="0" transform="" style="text-anchor: middle; display: none;"><tspan x="0" dy=".71em" dx="0">11/3</tspan></text></g><g class="tick" transform="translate(391, 0)" style="opacity: 1;"><line y2="6" x1="0" x2="0"></line><text y="9" x="0" transform="" style="text-anchor: middle; display: none;"><tspan x="0" dy=".71em" dx="0">11/4</tspan></text></g><g class="tick" transform="translate(419, 0)" style="opacity: 1;"><line y2="6" x1="0" x2="0"></line><text y="9" x="0" transform="" style="text-anchor: middle; display: none;"><tspan x="0" dy=".71em" dx="0">11/5</tspan></text></g><g class="tick" transform="translate(446, 0)" style="opacity: 1;"><line y2="6" x1="0" x2="0"></line><text y="9" x="0" transform="" style="text-anchor: middle; display: block;"><tspan x="0" dy=".71em" dx="0">11/6</tspan></text></g><g class="tick" transform="translate(473, 0)" style="opacity: 1;"><line y2="6" x1="0" x2="0"></line><text y="9" x="0" transform="" style="text-anchor: middle; display: none;"><tspan x="0" dy=".71em" dx="0">11/7</tspan></text></g><g class="tick" transform="translate(501, 0)" style="opacity: 1;"><line y2="6" x1="0" x2="0"></line><text y="9" x="0" transform="" style="text-anchor: middle; display: none;"><tspan x="0" dy=".71em" dx="0">11/8</tspan></text></g><g class="tick" transform="translate(528, 0)" style="opacity: 1;"><line y2="6" x1="0" x2="0"></line><text y="9" x="0" transform="" style="text-anchor: middle; display: none;"><tspan x="0" dy=".71em" dx="0">11/9</tspan></text></g><g class="tick" transform="translate(555, 0)" style="opacity: 1;"><line y2="6" x1="0" x2="0"></line><text y="9" x="0" transform="" style="text-anchor: middle; display: block;"><tspan x="0" dy=".71em" dx="0">11/10</tspan></text></g><g class="tick" transform="translate(583, 0)" style="opacity: 1;"><line y2="6" x1="0" x2="0"></line><text y="9" x="0" transform="" style="text-anchor: middle; display: none;"><tspan x="0" dy=".71em" dx="0">11/11</tspan></text></g><g class="tick" transform="translate(610, 0)" style="opacity: 1;"><line y2="6" x1="0" x2="0"></line><text y="9" x="0" transform="" style="text-anchor: middle; display: none;"><tspan x="0" dy=".71em" dx="0">11/12</tspan></text></g><g class="tick" transform="translate(637, 0)" style="opacity: 1;"><line y2="6" x1="0" x2="0"></line><text y="9" x="0" transform="" style="text-anchor: middle; display: none;"><tspan x="0" dy=".71em" dx="0">11/13</tspan></text></g><g class="tick" transform="translate(665, 0)" style="opacity: 1;"><line y2="6" x1="0" x2="0"></line><text y="9" x="0" transform="" style="text-anchor: middle; display: block;"><tspan x="0" dy=".71em" dx="0">11/14</tspan></text></g><g class="tick" transform="translate(692, 0)" style="opacity: 1;"><line y2="6" x1="0" x2="0"></line><text y="9" x="0" transform="" style="text-anchor: middle; display: none;"><tspan x="0" dy=".71em" dx="0">11/15</tspan></text></g><g class="tick" transform="translate(720, 0)" style="opacity: 1;"><line y2="6" x1="0" x2="0"></line><text y="9" x="0" transform="" style="text-anchor: middle; display: none;"><tspan x="0" dy=".71em" dx="0">11/16</tspan></text></g><g class="tick" transform="translate(747, 0)" style="opacity: 1;"><line y2="6" x1="0" x2="0"></line><text y="9" x="0" transform="" style="text-anchor: middle; display: none;"><tspan x="0" dy=".71em" dx="0">11/17</tspan></text></g><g class="tick" transform="translate(774, 0)" style="opacity: 1;"><line y2="6" x1="0" x2="0"></line><text y="9" x="0" transform="" style="text-anchor: middle; display: block;"><tspan x="0" dy=".71em" dx="0">11/18</tspan></text></g><g class="tick" transform="translate(802, 0)" style="opacity: 1;"><line y2="6" x1="0" x2="0"></line><text y="9" x="0" transform="" style="text-anchor: middle; display: none;"><tspan x="0" dy=".71em" dx="0">11/19</tspan></text></g><path class="domain" d="M0,6V0H809V6"></path></g><g class="c3-axis c3-axis-y" clip-path="url(https://qiita.com/hiko1129/contributions#c3-1542555218841-clip-yaxis)" transform="translate(0,0)" style="visibility: visible; opacity: 1;"><text class="c3-axis-y-label" transform="rotate(-90)" style="text-anchor: end;" x="0" dx="-0.5em" dy="1.2em"></text><g class="tick" transform="translate(0,199)" style="opacity: 1;"><line x2="-6"></line><text x="-9" y="0" style="text-anchor: end;"><tspan x="-9" dy="3">0</tspan></text></g><g class="tick" transform="translate(0,19)" style="opacity: 1;"><line x2="-6"></line><text x="-9" y="0" style="text-anchor: end;"><tspan x="-9" dy="3">1</tspan></text></g><path class="domain" d="M-6,1H0V216H-6"></path></g><g class="c3-axis c3-axis-y2" transform="translate(809,0)" style="visibility: hidden; opacity: 1;"><text class="c3-axis-y2-label" transform="rotate(-90)" style="text-anchor: end;" x="0" dx="-0.5em" dy="-0.5em"></text><g class="tick" transform="translate(0,216)" style="opacity: 1;"><line x2="6" y2="0"></line><text x="9" y="0" style="text-anchor: start;"><tspan x="9" dy="3">0</tspan></text></g><g class="tick" transform="translate(0,195)" style="opacity: 1;"><line x2="6" y2="0"></line><text x="9" y="0" style="text-anchor: start;"><tspan x="9" dy="3">0.1</tspan></text></g><g class="tick" transform="translate(0,173)" style="opacity: 1;"><line x2="6" y2="0"></line><text x="9" y="0" style="text-anchor: start;"><tspan x="9" dy="3">0.2</tspan></text></g><g class="tick" transform="translate(0,152)" style="opacity: 1;"><line x2="6" y2="0"></line><text x="9" y="0" style="text-anchor: start;"><tspan x="9" dy="3">0.3</tspan></text></g><g class="tick" transform="translate(0,130)" style="opacity: 1;"><line x2="6" y2="0"></line><text x="9" y="0" style="text-anchor: start;"><tspan x="9" dy="3">0.4</tspan></text></g><g class="tick" transform="translate(0,109)" style="opacity: 1;"><line x2="6" y2="0"></line><text x="9" y="0" style="text-anchor: start;"><tspan x="9" dy="3">0.5</tspan></text></g><g class="tick" transform="translate(0,87)" style="opacity: 1;"><line x2="6" y2="0"></line><text x="9" y="0" style="text-anchor: start;"><tspan x="9" dy="3">0.6</tspan></text></g><g class="tick" transform="translate(0,66)" style="opacity: 1;"><line x2="6" y2="0"></line><text x="9" y="0" style="text-anchor: start;"><tspan x="9" dy="3">0.7</tspan></text></g><g class="tick" transform="translate(0,44)" style="opacity: 1;"><line x2="6" y2="0"></line><text x="9" y="0" style="text-anchor: start;"><tspan x="9" dy="3">0.8</tspan></text></g><g class="tick" transform="translate(0,23)" style="opacity: 1;"><line x2="6" y2="0"></line><text x="9" y="0" style="text-anchor: start;"><tspan x="9" dy="3">0.9</tspan></text></g><g class="tick" transform="translate(0,1)" style="opacity: 1;"><line x2="6" y2="0"></line><text x="9" y="0" style="text-anchor: start;"><tspan x="9" dy="3">1</tspan></text></g><path class="domain" d="M6,1H0V216H6"></path></g></g><g transform="translate(20.5,270.5)" style="visibility: hidden;"><g clip-path="url(https://qiita.com/hiko1129/contributions#c3-1542555218841-clip-subchart)" class="c3-chart"><g class="c3-chart-bars"></g><g class="c3-chart-lines"></g></g><g clip-path="url(https://qiita.com/hiko1129/contributions#c3-1542555218841-clip)" class="c3-brush" style="pointer-events: all; -webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><rect class="background" x="0" width="819" style="visibility: hidden; cursor: crosshair;"></rect><rect class="extent" x="0" width="0" style="cursor: move;"></rect><g class="resize e" transform="translate(0,0)" style="cursor: ew-resize; display: none;"><rect x="-3" width="6" height="6" style="visibility: hidden;"></rect></g><g class="resize w" transform="translate(0,0)" style="cursor: ew-resize; display: none;"><rect x="-3" width="6" height="6" style="visibility: hidden;"></rect></g></g><g class="c3-axis-x" transform="translate(0,0)" clip-path="url(https://qiita.com/hiko1129/contributions#c3-1542555218841-clip-xaxis)" style="visibility: hidden; opacity: 1;"><g class="tick" transform="translate(8, 0)" style="opacity: 1;"><line y2="6" x1="0" x2="0"></line><text y="9" x="0" transform="" style="text-anchor: middle; display: block;"><tspan x="0" dy=".71em" dx="0">10/21</tspan></text></g><g class="tick" transform="translate(36, 0)" style="opacity: 1;"><line y2="6" x1="0" x2="0"></line><text y="9" x="0" transform="" style="text-anchor: middle; display: none;"><tspan x="0" dy=".71em" dx="0">10/22</tspan></text></g><g class="tick" transform="translate(63, 0)" style="opacity: 1;"><line y2="6" x1="0" x2="0"></line><text y="9" x="0" transform="" style="text-anchor: middle; display: none;"><tspan x="0" dy=".71em" dx="0">10/23</tspan></text></g><g class="tick" transform="translate(90, 0)" style="opacity: 1;"><line y2="6" x1="0" x2="0"></line><text y="9" x="0" transform="" style="text-anchor: middle; display: none;"><tspan x="0" dy=".71em" dx="0">10/24</tspan></text></g><g class="tick" transform="translate(118, 0)" style="opacity: 1;"><line y2="6" x1="0" x2="0"></line><text y="9" x="0" transform="" style="text-anchor: middle; display: block;"><tspan x="0" dy=".71em" dx="0">10/25</tspan></text></g><g class="tick" transform="translate(145, 0)" style="opacity: 1;"><line y2="6" x1="0" x2="0"></line><text y="9" x="0" transform="" style="text-anchor: middle; display: none;"><tspan x="0" dy=".71em" dx="0">10/26</tspan></text></g><g class="tick" transform="translate(173, 0)" style="opacity: 1;"><line y2="6" x1="0" x2="0"></line><text y="9" x="0" transform="" style="text-anchor: middle; display: none;"><tspan x="0" dy=".71em" dx="0">10/27</tspan></text></g><g class="tick" transform="translate(200, 0)" style="opacity: 1;"><line y2="6" x1="0" x2="0"></line><text y="9" x="0" transform="" style="text-anchor: middle; display: none;"><tspan x="0" dy=".71em" dx="0">10/28</tspan></text></g><g class="tick" transform="translate(227, 0)" style="opacity: 1;"><line y2="6" x1="0" x2="0"></line><text y="9" x="0" transform="" style="text-anchor: middle; display: block;"><tspan x="0" dy=".71em" dx="0">10/29</tspan></text></g><g class="tick" transform="translate(255, 0)" style="opacity: 1;"><line y2="6" x1="0" x2="0"></line><text y="9" x="0" transform="" style="text-anchor: middle; display: none;"><tspan x="0" dy=".71em" dx="0">10/30</tspan></text></g><g class="tick" transform="translate(282, 0)" style="opacity: 1;"><line y2="6" x1="0" x2="0"></line><text y="9" x="0" transform="" style="text-anchor: middle; display: none;"><tspan x="0" dy=".71em" dx="0">10/31</tspan></text></g><g class="tick" transform="translate(309, 0)" style="opacity: 1;"><line y2="6" x1="0" x2="0"></line><text y="9" x="0" transform="" style="text-anchor: middle; display: none;"><tspan x="0" dy=".71em" dx="0">11/1</tspan></text></g><g class="tick" transform="translate(337, 0)" style="opacity: 1;"><line y2="6" x1="0" x2="0"></line><text y="9" x="0" transform="" style="text-anchor: middle; display: block;"><tspan x="0" dy=".71em" dx="0">11/2</tspan></text></g><g class="tick" transform="translate(364, 0)" style="opacity: 1;"><line y2="6" x1="0" x2="0"></line><text y="9" x="0" transform="" style="text-anchor: middle; display: none;"><tspan x="0" dy=".71em" dx="0">11/3</tspan></text></g><g class="tick" transform="translate(391, 0)" style="opacity: 1;"><line y2="6" x1="0" x2="0"></line><text y="9" x="0" transform="" style="text-anchor: middle; display: none;"><tspan x="0" dy=".71em" dx="0">11/4</tspan></text></g><g class="tick" transform="translate(419, 0)" style="opacity: 1;"><line y2="6" x1="0" x2="0"></line><text y="9" x="0" transform="" style="text-anchor: middle; display: none;"><tspan x="0" dy=".71em" dx="0">11/5</tspan></text></g><g class="tick" transform="translate(446, 0)" style="opacity: 1;"><line y2="6" x1="0" x2="0"></line><text y="9" x="0" transform="" style="text-anchor: middle; display: block;"><tspan x="0" dy=".71em" dx="0">11/6</tspan></text></g><g class="tick" transform="translate(473, 0)" style="opacity: 1;"><line y2="6" x1="0" x2="0"></line><text y="9" x="0" transform="" style="text-anchor: middle; display: none;"><tspan x="0" dy=".71em" dx="0">11/7</tspan></text></g><g class="tick" transform="translate(501, 0)" style="opacity: 1;"><line y2="6" x1="0" x2="0"></line><text y="9" x="0" transform="" style="text-anchor: middle; display: none;"><tspan x="0" dy=".71em" dx="0">11/8</tspan></text></g><g class="tick" transform="translate(528, 0)" style="opacity: 1;"><line y2="6" x1="0" x2="0"></line><text y="9" x="0" transform="" style="text-anchor: middle; display: none;"><tspan x="0" dy=".71em" dx="0">11/9</tspan></text></g><g class="tick" transform="translate(555, 0)" style="opacity: 1;"><line y2="6" x1="0" x2="0"></line><text y="9" x="0" transform="" style="text-anchor: middle; display: block;"><tspan x="0" dy=".71em" dx="0">11/10</tspan></text></g><g class="tick" transform="translate(583, 0)" style="opacity: 1;"><line y2="6" x1="0" x2="0"></line><text y="9" x="0" transform="" style="text-anchor: middle; display: none;"><tspan x="0" dy=".71em" dx="0">11/11</tspan></text></g><g class="tick" transform="translate(610, 0)" style="opacity: 1;"><line y2="6" x1="0" x2="0"></line><text y="9" x="0" transform="" style="text-anchor: middle; display: none;"><tspan x="0" dy=".71em" dx="0">11/12</tspan></text></g><g class="tick" transform="translate(637, 0)" style="opacity: 1;"><line y2="6" x1="0" x2="0"></line><text y="9" x="0" transform="" style="text-anchor: middle; display: none;"><tspan x="0" dy=".71em" dx="0">11/13</tspan></text></g><g class="tick" transform="translate(665, 0)" style="opacity: 1;"><line y2="6" x1="0" x2="0"></line><text y="9" x="0" transform="" style="text-anchor: middle; display: block;"><tspan x="0" dy=".71em" dx="0">11/14</tspan></text></g><g class="tick" transform="translate(692, 0)" style="opacity: 1;"><line y2="6" x1="0" x2="0"></line><text y="9" x="0" transform="" style="text-anchor: middle; display: none;"><tspan x="0" dy=".71em" dx="0">11/15</tspan></text></g><g class="tick" transform="translate(720, 0)" style="opacity: 1;"><line y2="6" x1="0" x2="0"></line><text y="9" x="0" transform="" style="text-anchor: middle; display: none;"><tspan x="0" dy=".71em" dx="0">11/16</tspan></text></g><g class="tick" transform="translate(747, 0)" style="opacity: 1;"><line y2="6" x1="0" x2="0"></line><text y="9" x="0" transform="" style="text-anchor: middle; display: none;"><tspan x="0" dy=".71em" dx="0">11/17</tspan></text></g><g class="tick" transform="translate(774, 0)" style="opacity: 1;"><line y2="6" x1="0" x2="0"></line><text y="9" x="0" transform="" style="text-anchor: middle; display: block;"><tspan x="0" dy=".71em" dx="0">11/18</tspan></text></g><g class="tick" transform="translate(802, 0)" style="opacity: 1;"><line y2="6" x1="0" x2="0"></line><text y="9" x="0" transform="" style="text-anchor: middle; display: none;"><tspan x="0" dy=".71em" dx="0">11/19</tspan></text></g><path class="domain" d="M0,6V0H809V6"></path></g></g><g transform="translate(0,250)"><g class="c3-legend-item c3-legend-item-contribution" style="visibility: hidden; cursor: pointer;"><text x="14" y="9" style="pointer-events: none;">contribution</text><rect class="c3-legend-item-event" x="0" y="-5" width="0" height="0" style="fill-opacity: 0;"></rect><line class="c3-legend-item-tile" x1="-2" y1="4" x2="8" y2="4" stroke-width="10" style="pointer-events: none;"></line></g></g><text class="c3-title" x="425" y="0"></text></svg><div class="c3-tooltip-container" style="position: absolute; pointer-events: none; display: none; top: 208.5px; left: 414.5px;"><table class="c3-tooltip"><tbody><tr><th colspan="2">11/3</th></tr><tr class="c3-tooltip-name--contribution"><td class="name"><span style="background-color:null"></span>contribution</td><td class="value">0</td></tr></tbody></table></div></div><div class="row userActivityChart_stats"><a class="col-xs-4 userActivityChart_stat " href="/hiko1129"><span class="userActivityChart_statCount">0</span><br> <span class="userActivityChart_statUnit">Items</span></a><a class="col-xs-4 userActivityChart_stat active" href="/hiko1129/contributions"><span class="userActivityChart_statCount">0</span><br> <span class="userActivityChart_statUnit">Contribution</span></a><a class="col-xs-4 userActivityChart_stat " href="/hiko1129/followers"><span class="userActivityChart_statCount">2</span><br> <span class="userActivityChart_statUnit">Followers</span></a></div></div>`

	httpmock.RegisterResponder("GET", "https://qiita.com/hiko1129/contributions", httpmock.NewStringResponder(200, dom))

	c, err = infrastructure.NewContirubutionClient()
	assert.NoError(t, err)

	contributions, err = c.FetchContributions("hiko1129")
	assert.Equal(t, 0, contributions["2018-11-08"])
	assert.NoError(t, err)
}

func TestFetchTotalContributionCount(t *testing.T) {
	// real
	c, err := infrastructure.NewContirubutionClient()
	assert.NoError(t, err)

	_, err = c.FetchTotalContribution("hiko1129")
	assert.NoError(t, err)

	// mock
	httpmock.Activate()
	defer httpmock.DeactivateAndReset()
	httpmock.RegisterResponder("GET", "https://qiita.com/api/internal/hovercard_users/hiko1129", httpmock.NewStringResponder(200, `{"contribution": 100}`))

	c, err = infrastructure.NewContirubutionClient()
	assert.NoError(t, err)

	user, err := c.FetchTotalContribution("hiko1129")
	assert.Equal(t, 100, user.Contribution)
	assert.NoError(t, err)
}
